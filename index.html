<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£Ø°ÙƒÙŠØ§Ø¡ ÙÙŠ Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„ÙˆÙ… - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ø­Ù„</title>
    
    <style>
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e2e8f0;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .autocomplete-item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid #f1f5f9;
            transition: background 0.2s;
        }

        .autocomplete-item:hover {
            background: #f7fafc;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

       .autocomplete-class {
            font-size: 0.8rem;
            color: #718096;
            margin-right: 10px;
        }
        
        .autocomplete-score {
            font-size: 0.8rem;
            color: #667eea;
            font-weight: bold;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .export-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #48bb78;
            --warning-color: #ed8936;
            --danger-color: #e53e3e;
            --light-bg: #f7fafc;
            --text-dark: #2d3748;
            --text-light: #718096;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: var(--text-dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            background: white;
            padding: clamp(15px, 3vw, 25px);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: var(--text-dark);
            margin: 0;
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .login-form, .quiz-container, .teacher-panel, .level-selection {
            background: white;
            padding: clamp(20px, 4vw, 30px);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
            font-family: inherit;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-teacher {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .level-card {
            background: var(--light-bg);
            padding: 25px;
            border-radius: 15px;
            margin: 15px 0;
            border: 3px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .level-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .level-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f1f5f9;
        }

        .level-card.completed {
            border-color: var(--success-color);
            background: linear-gradient(135deg, #c6f6d5 0%, #9ae6b4 100%);
        }

        .level-icon {
            font-size: clamp(2.5rem, 5vw, 3rem);
            margin-bottom: 10px;
        }

        .level-name {
            font-size: clamp(1.2rem, 2.5vw, 1.5rem);
            font-weight: bold;
            margin-bottom: 10px;
        }

        .question-card {
            background: var(--light-bg);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 5px solid var(--primary-color);
        }

        .question-text {
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--text-dark);
        }

        .options {
            display: grid;
            gap: 12px;
        }

        .option {
            background: white;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 500;
        }

        .option:hover {
            border-color: var(--primary-color);
            background: #edf2f7;
        }

        .option.correct {
            background: #c6f6d5;
            border-color: #38a169;
            color: #22543d;
        }

        .option.incorrect {
            background: #fed7d7;
            border-color: #e53e3e;
            color: #742a2a;
        }

        .hidden {
            display: none !important;
        }

        .score-display {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 20px 0;
        }

        .level-header {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            color: white;
            font-weight: bold;
        }

        .progress-bar {
            background: #e2e8f0;
            height: 10px;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            height: 100%;
            transition: width 0.5s;
        }

        .feedback {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .feedback.correct {
            background: #c6f6d5;
            color: #22543d;
        }

        .feedback.incorrect {
            background: #fed7d7;
            color: #742a2a;
        }

        .leaderboard {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .student-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            margin-bottom: 8px;
            border-radius: 8px;
            border-right: 4px solid #667eea;
        }

        .rank {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .timer-container {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: var(--light-bg);
            border-radius: 10px;
            border: 2px solid var(--primary-color);
        }

        .timer {
            font-size: clamp(1.5rem, 3vw, 2rem);
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .timer.warning {
            color: var(--warning-color);
            animation: pulse 1s infinite;
        }

        .timer.danger {
            color: var(--danger-color);
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .question-actions {
            display: flex;
            gap: 10px;
        }

        .btn-edit {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%) !important;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .btn-delete {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%) !important;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .cloud-status {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-top: 10px;
            display: inline-block;
        }

        .cloud-connected {
            background: #c6f6d5;
            color: #22543d;
        }

        .cloud-disconnected {
            background: #fed7d7;
            color: #742a2a;
        }

        .cloud-syncing {
            background: #bee3f8;
            color: #2a4365;
        }

        .edit-modal, .level-complete-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 20px;
        }

        .edit-modal-content, .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--light-bg);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .import-export-section {
            background: var(--light-bg);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .timer-settings {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .btn {
                width: 100%;
                margin: 5px 0;
            }
            
            .student-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .question-actions {
                flex-direction: column;
                width: 100%;
            }

            .timer-settings {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="animationContainer" class="confetti-container"></div>

    <div class="container">
        <div class="header">
            <h1>ğŸ§ª Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£Ø°ÙƒÙŠØ§Ø¡ ÙÙŠ Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„ÙˆÙ… ğŸ”¬</h1>
            <div id="cloudStatus" class="cloud-status cloud-syncing">
                ğŸ”„ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...
            </div>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div id="loginForm" class="login-form">
            <h2 style="text-align: center; color: #4a5568; margin-bottom: 30px;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©!</h2>
            <div class="form-group">
                <label for="studentName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
                <div class="autocomplete-container">
                    <input type="text" id="studentName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§ - Ø§ÙƒØªØ¨ 3 Ø£Ø­Ø±Ù Ù„Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©" 
                           oninput="searchStudents(this.value)" 
                           onfocus="searchStudents(this.value)"
                           onblur="hideAutocomplete()"
                           autocomplete="off">
                    <div id="autocompleteList" class="autocomplete-list hidden"></div>
                </div>
            </div>

            <div class="form-group">
                <label for="className">Ø§Ù„ÙØµÙ„:</label>
                <select id="className">
                    <option value="">Ø§Ø®ØªØ± ÙØµÙ„Ùƒ</option>
                    <option value="Ø§Ù„Ø±Ø§Ø¨Ø¹-1">Ø§Ù„Ø±Ø§Ø¨Ø¹-1</option>
                    <option value="Ø§Ù„Ø±Ø§Ø¨Ø¹-2">Ø§Ù„Ø±Ø§Ø¨Ø¹-2</option>
                    <option value="Ø§Ù„Ø±Ø§Ø¨Ø¹-3">Ø§Ù„Ø±Ø§Ø¨Ø¹-3</option>
                    <option value="Ø§Ù„Ø±Ø§Ø¨Ø¹-4">Ø§Ù„Ø±Ø§Ø¨Ø¹-4</option>
                    <option value="Ø§Ù„Ø±Ø§Ø¨Ø¹-5">Ø§Ù„Ø±Ø§Ø¨Ø¹-5</option>
                </select>
            </div>
            
            <div style="text-align: center;">
                <button class="btn" onclick="showLevelSelection()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ğŸš€</button>
                <button class="btn btn-teacher" onclick="showTeacherLogin()">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… ğŸ‘¨â€ğŸ«</button>
            </div>

            <div style="text-align: center; margin-top: 20px; padding: 15px; background: #f0fff4; border-radius: 10px;">
                <div style="color: #22543d; font-weight: bold;">â˜ï¸ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ Ù…ÙØ¹Ù„</div>
                <div style="color: #38a169; font-size: 0.9rem;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙŠØ´ØªØ±ÙƒÙˆÙ† ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± JSONBin</div>
            </div>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù… -->
        <div id="teacherLoginForm" class="login-form hidden">
            <h2 style="text-align: center; color: #4a5568; margin-bottom: 30px;">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…</h2>
            
            <div class="form-group">
                <label for="teacherEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                <input type="email" id="teacherEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            </div>
            
            <div class="form-group">
                <label for="teacherPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                <input type="password" id="teacherPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            
            <div style="text-align: center;">
                <button class="btn btn-teacher" onclick="verifyTeacherLogin()">Ø¯Ø®ÙˆÙ„ ğŸ”‘</button>
                <button class="btn" onclick="showLoginForm()">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
            </div>
            
            <div id="loginError" class="hidden" style="background: #fed7d7; color: #742a2a; padding: 15px; border-radius: 8px; margin-top: 20px; text-align: center; font-weight: bold;">
                âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©
            </div>
        </div>

        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø­Ù„Ø© -->
        <div id="levelSelection" class="level-selection hidden">
            <h2 style="text-align: center; color: #4a5568; margin-bottom: 30px;">Ø§Ø®ØªØ± Ù…Ø±Ø­Ù„ØªÙƒ</h2>
            <div id="levelCards">
                <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="showLoginForm()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            </div>
        </div>

        <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© -->
        <div id="quizContainer" class="quiz-container hidden">
            <div id="levelHeader" class="level-header">
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
            </div>

            <!-- Ø§Ù„Ù…Ø¤Ù‚Øª -->
            <div class="timer-container">
                <div>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</div>
                <div class="timer" id="questionTimer">30</div>
                <div>Ø«Ø§Ù†ÙŠØ©</div>
            </div>

            <div class="score-display">
                <span>Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></span>
                <span style="margin-right: 30px;">Ø§Ù„Ø³Ø¤Ø§Ù„: <span id="questionNumber">1</span> Ù…Ù† <span id="totalQuestions">5</span></span>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 20%"></div>
            </div>
            
            <div id="questionCard" class="question-card">
                <!-- Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
            
            <div id="feedback" class="feedback hidden"></div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button id="nextBtn" class="btn hidden" onclick="nextQuestion()">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
            </div>
        </div>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… -->
        <div id="teacherPanel" class="teacher-panel hidden">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: #4a5568; margin-bottom: 20px;">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¹Ù„Ù…</h2>
                <div>
                    <button class="btn" id="statsTab" onclick="showTab('stats')">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                    <button class="btn" id="questionsTab" onclick="showTab('questions')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
                    <button class="btn" id="timerTab" onclick="showTab('timer')">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø­Ù„</button>
                </div>
            </div>

            <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
            <div id="statsSection">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4 style="color: #667eea; margin: 0;">ğŸŒ± Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†</h4>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #48bb78;" id="level1Count">0</div>
                    </div>
                    <div class="stat-card">
                        <h4 style="color: #667eea; margin: 0;">â­ Ù†Ø¬ÙˆÙ…</h4>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #4299e1;" id="level2Count">0</div>
                    </div>
                    <div class="stat-card">
                        <h4 style="color: #667eea; margin: 0;">ğŸ”¥ Ù…Ø¬ØªÙ‡Ø¯ÙŠÙ†</h4>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #ed8936;" id="level3Count">0</div>
                    </div>
                    <div class="stat-card">
                        <h4 style="color: #667eea; margin: 0;">ğŸ’ Ø®Ø¨Ø±Ø§Ø¡</h4>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #9f7aea;" id="level4Count">0</div>
                    </div>
                    <div class="stat-card">
                        <h4 style="color: #667eea; margin: 0;">ğŸ‘‘ Ø£Ø¨Ø·Ø§Ù„</h4>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #d69e2e;" id="level5Count">0</div>
                    </div>
                </div>
                <div class="leaderboard">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ğŸ† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø±Ù - ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠØ© ğŸ†</h3>
                        <div>
                            <button class="btn" onclick="exportLeaderboardExcel()" style="background: #38a169;">ğŸ“Š ØªØµØ¯ÙŠØ± Excel</button>
                            <button class="btn" onclick="printLeaderboard()" style="background: #667eea;">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                        </div>
                    </div>
                    <div id="leaderboardList">
                        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…ØªÙÙˆÙ‚ÙŠÙ† Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                </div>
            </div>

            <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
            <div id="questionsSection" class="hidden">
                <div style="background: #f7fafc; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="color: #4a5568; margin-bottom: 20px;">Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯</h3>
                    
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø±Ø­Ù„Ø©:</label>
                        <select id="questionLevel">
                            <option value="1">ğŸŒ± Ø§Ù„Ù…Ø¨ØªØ¯Ø¦ Ø§Ù„ØµØºÙŠØ±</option>
                            <option value="2">â­ Ø§Ù„Ù†Ø¬Ù… Ø§Ù„ØµØ§Ø¹Ø¯</option>
                            <option value="3">ğŸ”¥ Ø§Ù„Ù…Ø¬ØªÙ‡Ø¯ Ø§Ù„Ù†Ø´ÙŠØ·</option>
                            <option value="4">ğŸ’ Ø§Ù„Ø®Ø¨ÙŠØ± Ø§Ù„Ù…Ø§Ù‡Ø±</option>
                            <option value="5">ğŸ‘‘ Ø¨Ø·Ù„ Ø§Ù„Ø£Ø°ÙƒÙŠØ§Ø¡</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
                        <select id="questionType" onchange="toggleQuestionType()">
                            <option value="multiple">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</option>
                            <option value="boolean">ØµØ­ ÙˆØ®Ø·Ø£</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
                        <textarea id="questionText" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§..." rows="3"></textarea>
                    </div>

                    <div id="multipleChoiceOptions">
                        <div class="form-group">
                            <label>Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„:</label>
                            <input type="text" id="option1" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
                            <input type="text" id="option2" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«:</label>
                            <input type="text" id="option3" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</label>
                            <select id="correctOption">
                                <option value="0">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„</option>
                                <option value="1">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                                <option value="2">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«</option>
                            </select>
                        </div>
                    </div>

                    <div id="booleanOptions" class="hidden">
                        <div class="form-group">
                            <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</label>
                            <select id="booleanAnswer">
                                <option value="true">ØµØ­ÙŠØ­</option>
                                <option value="false">Ø®Ø·Ø£</option>
                            </select>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" onclick="addQuestion()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ â•</button>
                        <button class="btn" onclick="clearQuestionForm()" style="background: #718096;">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
                    </div>
                </div>

                <div style="text-align: center; margin: 15px 0;">
                    <button class="btn" onclick="checkLevelsQuestions()" style="background: #ed8936;">
                        ğŸ” ÙØ­Øµ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ø­Ù„
                    </button>
                </div>

                <div class="leaderboard">
                    <h3>ğŸ“ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                    <div id="questionsList">
                        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                </div>
            </div>

            <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø­Ù„ -->
            <div id="timerSection" class="hidden">
                <div style="background: #f7fafc; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="color: #4a5568; margin-bottom: 20px;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø­Ù„ ÙˆØ§Ù„Ù…Ø¤Ù‚Øª</h3>
                    
                    <div id="levelSettings">
                        <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" onclick="saveLevelSettings()">ğŸ’¾ Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø­Ù„</button>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="showLoginForm()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                <button class="btn btn-teacher" onclick="clearAllData()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>

        <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
        <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); margin-top: 30px; text-align: center; color: #4a5568; font-size: 0.9rem; line-height: 1.6;">
            <div style="margin-bottom: 10px;">
                <strong>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2025</strong>
            </div>
            <div style="color: #667eea; font-weight: bold;">
                ØªØµÙ…ÙŠÙ…: Ø§Ù„Ø£Ø³ØªØ§Ø° / Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù‡Ø±ÙŠ
            </div>
            <div style="color: #718096; margin-top: 5px;">
                Ù…Ø¯Ø±Ø³Ø© Ø§Ù„ÙˆÙ„ÙŠØ¯ Ø¨Ù† Ø¹Ù…Ø§Ø±Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø±Ø­Ù„Ø© -->
    <div id="levelCompleteModal" class="level-complete-modal hidden">
        <div class="modal-content">
            <div id="modalContent">
                <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„ -->
    <div id="editQuestionModal" class="edit-modal hidden">
        <div class="edit-modal-content">
            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </div>
    </div>

    <script>
        // ğŸ”¥ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª JSONBin Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
        const JSONBIN_API_KEY = "$2a$10$7Ci.oly.61ETIQbhY/4RaueLwb/u/IgvNUdIT2AqZlyW2VAaTeBI.";
        const JSONBIN_BIN_ID = "6931d320d0ea881f401312bb";
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let questions = [];
        let studentsData = [];
        let levels = {};
        let currentStudent = null;
        let currentQuestionIndex = 0;
        let score = 0;
        let currentTab = 'stats';
        let currentLevel = 1;
        let levelQuestions = [];
        let questionTimer = null;
        let timeLeft = 30;
        let currentEditingQuestion = null;

        // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        const defaultLevels = {
            1: { 
                name: "Ø§Ù„Ù…Ø¨ØªØ¯Ø¦ Ø§Ù„ØµØºÙŠØ±", 
                icon: "ğŸŒ±", 
                color: "#48bb78", 
                passingScore: 30, 
                time: 30,
                questionsRequired: 3
            },
            2: { 
                name: "Ø§Ù„Ù†Ø¬Ù… Ø§Ù„ØµØ§Ø¹Ø¯", 
                icon: "â­", 
                color: "#4299e1", 
                passingScore: 50, 
                time: 25,
                questionsRequired: 4
            },
            3: { 
                name: "Ø§Ù„Ù…Ø¬ØªÙ‡Ø¯ Ø§Ù„Ù†Ø´ÙŠØ·", 
                icon: "ğŸ”¥", 
                color: "#ed8936", 
                passingScore: 70, 
                time: 20,
                questionsRequired: 5
            },
            4: { 
                name: "Ø§Ù„Ø®Ø¨ÙŠØ± Ø§Ù„Ù…Ø§Ù‡Ø±", 
                icon: "ğŸ’", 
                color: "#9f7aea", 
                passingScore: 90, 
                time: 15,
                questionsRequired: 6
            },
            5: { 
                name: "Ø¨Ø·Ù„ Ø§Ù„Ø£Ø°ÙƒÙŠØ§Ø¡", 
                icon: "ğŸ‘‘", 
                color: "#d69e2e", 
                passingScore: 120, 
                time: 10,
                questionsRequired: 7
            }
        };

        // Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        const defaultQuestions = [
            {
                id: 1,
                type: "multiple",
                question: "Ø£ÙŠ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙˆØ§ÙƒØ¨ Ø£Ù‚Ø±Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø´Ù…Ø³ØŸ",
                options: ["Ø§Ù„Ø£Ø±Ø¶", "Ø§Ù„Ù…Ø±ÙŠØ®", "Ø¹Ø·Ø§Ø±Ø¯"],
                correct: 2,
                level: 1
            },
            {
                id: 2,
                type: "boolean",
                question: "Ø§Ù„Ø¶ÙˆØ¡ ÙŠÙ†ØªÙ‚Ù„ ÙÙŠ Ø®Ø·ÙˆØ· Ù…Ø³ØªÙ‚ÙŠÙ…Ø©.",
                correct: true,
                level: 1
            },
            {
                id: 3,
                type: "multiple",
                question: "Ù…Ø§ Ù‡ÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø«Ù„Ø§Ø«ØŸ",
                options: ["ØµÙ„Ø¨ØŒ Ø³Ø§Ø¦Ù„ØŒ ØºØ§Ø²", "Ø­Ø§Ø±ØŒ Ø¨Ø§Ø±Ø¯ØŒ Ù…Ø¹ØªØ¯Ù„", "Ø«Ù‚ÙŠÙ„ØŒ Ø®ÙÙŠÙØŒ Ù…ØªÙˆØ³Ø·"],
                correct: 0,
                level: 1
            },
            {
                id: 4,
                type: "boolean",
                question: "Ø§Ù„ØµÙˆØª Ù„Ø§ ÙŠÙ†ØªÙ‚Ù„ ÙÙŠ Ø§Ù„ÙØ±Ø§Øº.",
                correct: true,
                level: 2
            },
            {
                id: 5,
                type: "multiple",
                question: "Ù…Ø§ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙŠ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª Ù„ØµÙ†Ø¹ Ø§Ù„ØºØ°Ø§Ø¡ØŸ",
                options: ["Ø§Ù„ØªÙ†ÙØ³", "Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¶ÙˆØ¦ÙŠ", "Ø§Ù„ØªØ¨Ø®Ø±"],
                correct: 1,
                level: 2
            },
            {
                id: 6,
                type: "multiple",
                question: "Ø£ÙŠ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø«Ø¯ÙŠÙŠØ§ØªØŸ",
                options: ["Ø§Ù„Ø³Ù…ÙƒØ©", "Ø§Ù„Ø³Ù„Ø­ÙØ§Ø©", "Ø§Ù„Ù‚Ø·"],
                correct: 2,
                level: 2
            },
            {
                id: 7,
                type: "boolean",
                question: "Ø§Ù„Ù…Ø§Ø¡ ÙŠØºÙ„ÙŠ Ø¹Ù†Ø¯ Ø¯Ø±Ø¬Ø© 100 Ù…Ø¦ÙˆÙŠØ©.",
                correct: true,
                level: 3
            },
            {
                id: 8,
                type: "multiple",
                question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØºØ§Ø² Ø§Ù„Ø°ÙŠ ØªØªÙ†ÙØ³Ù‡ Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª Ù„ÙŠÙ„Ø§Ù‹ØŸ",
                options: ["Ø§Ù„Ø£ÙƒØ³Ø¬ÙŠÙ†", "Ø«Ø§Ù†ÙŠ Ø£ÙƒØ³ÙŠØ¯ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ†", "Ø§Ù„Ù†ÙŠØªØ±ÙˆØ¬ÙŠÙ†"],
                correct: 0,
                level: 3
            },
            {
                id: 9,
                type: "multiple",
                question: "Ø£ÙŠ Ù…Ù† Ù‡Ø°Ù‡ ÙŠØ¹ØªØ¨Ø± Ù…ØµØ¯Ø±Ø§Ù‹ Ù„Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ØªØ¬Ø¯Ø¯Ø©ØŸ",
                options: ["Ø§Ù„ÙØ­Ù…", "Ø§Ù„Ù†ÙØ·", "Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©"],
                correct: 2,
                level: 3
            },
            {
                id: 10,
                type: "boolean",
                question: "Ø§Ù„Ù‚Ù„Ø¨ ÙŠØ¶Ø® Ø§Ù„Ø¯Ù… Ø¥Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ø¬Ø³Ù….",
                correct: true,
                level: 4
            },
            {
                id: 11,
                type: "multiple",
                question: "Ù…Ø§ Ù‡Ùˆ Ø£Ù‚ÙˆÙ‰ Ø¹Ø¸Ù… ÙÙŠ Ø¬Ø³Ù… Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ØŸ",
                options: ["Ø¹Ø¸Ù… Ø§Ù„ÙØ®Ø°", "Ø¹Ø¸Ù… Ø§Ù„Ø°Ø±Ø§Ø¹", "Ø¹Ø¸Ù… Ø§Ù„Ø¬Ù…Ø¬Ù…Ø©"],
                correct: 0,
                level: 4
            },
            {
                id: 12,
                type: "multiple",
                question: "Ø£ÙŠ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙˆØ§ÙƒØ¨ Ù„Ù‡ Ø­Ù„Ù‚Ø§ØªØŸ",
                options: ["Ø§Ù„Ù…Ø±ÙŠØ®", "Ø²Ø­Ù„", "Ø§Ù„Ø²Ù‡Ø±Ø©"],
                correct: 1,
                level: 4
            },
            {
                id: 13,
                type: "boolean",
                question: "Ø§Ù„Ø°Ù‡Ø¨ Ø¹Ù†ØµØ± ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ.",
                correct: true,
                level: 5
            },
            {
                id: 14,
                type: "multiple",
                question: "Ù…Ø§ Ù‡Ùˆ Ø£Ø³Ø±Ø¹ Ø­ÙŠÙˆØ§Ù† Ø¨Ø±ÙŠØŸ",
                options: ["Ø§Ù„ÙÙ‡Ø¯", "Ø§Ù„Ø£Ø³Ø¯", "Ø§Ù„Ø­ØµØ§Ù†"],
                correct: 0,
                level: 5
            },
            {
                id: 15,
                type: "multiple",
                question: "Ø£ÙŠ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„ØºØ§Ø²Ø§Øª ÙŠÙˆØ¬Ø¯ Ø¨Ù†Ø³Ø¨Ø© Ø£ÙƒØ¨Ø± ÙÙŠ Ø§Ù„ØºÙ„Ø§Ù Ø§Ù„Ø¬ÙˆÙŠØŸ",
                options: ["Ø§Ù„Ø£ÙƒØ³Ø¬ÙŠÙ†", "Ø«Ø§Ù†ÙŠ Ø£ÙƒØ³ÙŠØ¯ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ†", "Ø§Ù„Ù†ÙŠØªØ±ÙˆØ¬ÙŠÙ†"],
                correct: 2,
                level: 5
            }
        ];
        
        // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¨Ø­Ø« Ù„ÙŠØ´Ù…Ù„ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
        function searchStudents(searchTerm) {
            const autocompleteList = document.getElementById('autocompleteList');

            if (searchTerm.length < 2) {
                autocompleteList.classList.add('hidden');
                return;
            }
 
            const searchLower = searchTerm.toLowerCase();
    
            // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ Ø¨Ø§Ù„ÙƒÙ„Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹
            const startsWith = studentsData.filter(student => 
                student.name.toLowerCase().startsWith(searchLower)
            );
    
            // Ø«Ù… Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø©
            const contains = studentsData.filter(student => 
                student.name.toLowerCase().includes(searchLower) && 
                !student.name.toLowerCase().startsWith(searchLower)
            );
    
            const matchedStudents = [...startsWith, ...contains];
            const limitedResults = matchedStudents.slice(0, 8);

            if (limitedResults.length > 0) {
                showAutocompleteList(limitedResults, searchTerm);
            } else {
                autocompleteList.classList.add('hidden');
            }
        }

        function showAutocompleteList(students, searchTerm) {
            const autocompleteList = document.getElementById('autocompleteList');
    
            const html = students.map(student => `
                <div class="autocomplete-item" onclick="selectStudent('${student.name.replace(/'/g, "\\'")}', '${student.class}')">
                    <div style="font-weight: bold;">${highlightMatch(student.name, searchTerm)}</div>
                    <div>
                        <span class="autocomplete-class">Ø§Ù„ÙØµÙ„: ${student.class}</span>
                        ${student.totalScores ? `<span class="autocomplete-score">â€¢ Ø§Ù„Ù†Ù‚Ø§Ø·: ${student.totalScores}</span>` : ''}
                    </div>
                </div>
            `).join('');
    
            autocompleteList.innerHTML = html;
            autocompleteList.classList.remove('hidden');
        }

        function highlightMatch(name, searchTerm) {
            const nameLower = name.toLowerCase();
            const searchLower = searchTerm.toLowerCase();
            const index = nameLower.indexOf(searchLower);
    
            if (index === -1) return name;
    
            return name.substring(0, index) + 
                   '<span style="color: #667eea; font-weight: bold; background: #f0fff4; padding: 2px 4px; border-radius: 4px;">' + 
                   name.substring(index, index + searchTerm.length) + 
                   '</span>' + 
                   name.substring(index + searchTerm.length);
        }

        function selectStudent(name, className) {
            document.getElementById('studentName').value = name;
            document.getElementById('className').value = className;
            hideAutocomplete();

            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø³Ø±ÙŠØ¹Ø©
            const notification = document.createElement('div');
            notification.innerHTML = `âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: <strong>${name}</strong> - ${className}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #48bb78;
                color: white;
                padding: 10px 20px;
                border-radius: 8px;
                z-index: 10000;
                font-weight: bold;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 2000);
        }

        function hideAutocomplete() {
            setTimeout(() => {
                document.getElementById('autocompleteList').classList.add('hidden');
            }, 200);
        }

        // Ù…Ù†Ø¹ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¯Ø§Ø®Ù„Ù‡Ø§
        document.addEventListener('DOMContentLoaded', function() {
            const autocompleteList = document.getElementById('autocompleteList');
            if (autocompleteList) {
                autocompleteList.addEventListener('mousedown', function(e) {
                    e.preventDefault();
                });
            }
        });

        // ğŸ“¦ Ø¯ÙˆØ§Ù„ JSONBin
        async function saveToJSONBin() {
            try {
                const data = {
                    questions: questions,
                    students: studentsData,
                    timerSettings: levels,
                    lastUpdated: new Date().toISOString()
                };
                
                const response = await fetch(JSONBIN_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY,
                        'X-Bin-Versioning': 'false'
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ JSONBin:', result);
                updateCloudStatus('âœ… Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©', 'connected');
                saveToLocal(); // Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ© ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                return true;
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ JSONBin:', error);
                updateCloudStatus('âŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©', 'disconnected');
                return false;
            }
        }

        async function loadFromJSONBin() {
            try {
                const response = await fetch(JSONBIN_URL + '/latest', {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                const data = result.record;
                
                if (data) {
                    questions = data.questions || [];
                    studentsData = data.students || [];
                    levels = data.timerSettings || JSON.parse(JSON.stringify(defaultLevels));
                    console.log('âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† JSONBin');
                    updateCloudStatus('âœ… Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©', 'connected');
                    saveToLocal(); // Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ©
                    return true;
                } else {
                    console.log('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ JSONBinØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
                    questions = [...defaultQuestions];
                    studentsData = [];
                    levels = JSON.parse(JSON.stringify(defaultLevels));
                    await saveToJSONBin();
                    return true;
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† JSONBin:', error);
                updateCloudStatus('âŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©', 'disconnected');
                return false;
            }
        }

        async function syncData() {
            const jsonBinSuccess = await saveToJSONBin();
            if (!jsonBinSuccess) {
                saveToLocal(); // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØŒ Ø§Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
            }
            return jsonBinSuccess;
        }

        async function loadData() {
            try {
                const jsonBinSuccess = await loadFromJSONBin();
                if (jsonBinSuccess) {
                    return true;
                }
            } catch (error) {
                console.log('ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† JSONBin');
            }
            
            return loadFromLocal();
        }

        function setupRealtimeUpdates() {
            try {
                // Ù…Ø¹ JSONBinØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ«Ø§Øª ÙÙˆØ±ÙŠØ©ØŒ Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¹Ù…Ù„ poll ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
                setInterval(async () => {
                    try {
                        const response = await fetch(JSONBIN_URL + '/latest', {
                            method: 'GET',
                            headers: {
                                'X-Master-Key': JSONBIN_API_KEY
                            }
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            const data = result.record;
                            
                            if (data) {
                                const oldQuestionsCount = questions.length;
                                
                                questions = data.questions || [];
                                studentsData = data.students || [];
                                levels = data.timerSettings || levels;
                                
                                if (currentTab === 'stats') updateTeacherPanel();
                                if (currentTab === 'questions') displayQuestionsList();
                                
                                if (oldQuestionsCount !== questions.length && currentTab === 'questions') {
                                    showNotification('ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©', 'info');
                                }
                            }
                        }
                    } catch (error) {
                        console.log('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
                    }
                }, 30000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
                
                console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©');
            } catch (error) {
                console.log('ØªØ¹Ø°Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©');
            }
        }

        function saveToLocal() {
            try {
                localStorage.setItem('science_competition_questions_jsonbin', JSON.stringify(questions));
                localStorage.setItem('science_competition_students_jsonbin', JSON.stringify(studentsData));
                localStorage.setItem('science_competition_levels_jsonbin', JSON.stringify(levels));
                console.log('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
                return true;
            } catch (error) {
                console.log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ:', error);
                return false;
            }
        }

        function loadFromLocal() {
            try {
                const savedQuestions = localStorage.getItem('science_competition_questions_jsonbin');
                const savedStudents = localStorage.getItem('science_competition_students_jsonbin');
                const savedLevels = localStorage.getItem('science_competition_levels_jsonbin');
                
                questions = savedQuestions ? JSON.parse(savedQuestions) : [...defaultQuestions];
                studentsData = savedStudents ? JSON.parse(savedStudents) : [];
                levels = savedLevels ? JSON.parse(savedLevels) : JSON.parse(JSON.stringify(defaultLevels));
                
                console.log('âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ');
                updateCloudStatus('ğŸ’¾ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©', 'disconnected');
                return true;
            } catch (error) {
                console.log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ:', error);
                questions = [...defaultQuestions];
                studentsData = [];
                levels = JSON.parse(JSON.stringify(defaultLevels));
                return false;
            }
        }

        function updateCloudStatus(message, status) {
            const statusElement = document.getElementById('cloudStatus');
            if (!statusElement) return;

            statusElement.textContent = message;
            statusElement.className = 'cloud-status';
            
            if (status === 'connected') {
                statusElement.classList.add('cloud-connected');
            } else if (status === 'disconnected') {
                statusElement.classList.add('cloud-disconnected');
            } else if (status === 'syncing') {
                statusElement.classList.add('cloud-syncing');
            }
        }

        // ğŸ¯ Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        function showLevelSelection() {
            const name = document.getElementById('studentName').value.trim();
            const className = document.getElementById('className').value;
            
            if (!name || !className) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØµÙ„');
                return;
            }

            currentStudent = {
                name: name,
                class: className,
                maxLevel: 1,
                completedLevels: [],
                totalScores: 0,
                scores: {},
                attempts: {}
            };

            const existingStudent = studentsData.find(s => s.name === name && s.class === className);
            if (existingStudent) {
                currentStudent.maxLevel = existingStudent.maxLevel || 1;
                currentStudent.completedLevels = existingStudent.completedLevels || [];
                currentStudent.totalScores = existingStudent.totalScores || 0;
                currentStudent.scores = existingStudent.scores || {};
                currentStudent.attempts = existingStudent.attempts || {};
            }

            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('levelSelection').classList.remove('hidden');
            
            displayLevelCards();
        }

        function displayLevelCards() {
            const levelCards = document.getElementById('levelCards');
            levelCards.innerHTML = '';

            for (let i = 1; i <= 5; i++) {
                const level = levels[i];
                const isUnlocked = i <= currentStudent.maxLevel;
                const isCompleted = currentStudent.completedLevels.includes(i);
                const levelQuestionsForThisLevel = questions.filter(q => q.level == i);
                const hasQuestions = levelQuestionsForThisLevel.length > 0;
                
                const bestScore = currentStudent.scores ? currentStudent.scores[i] || 0 : 0;

                const card = document.createElement('div');
                card.className = `level-card ${!isUnlocked ? 'locked' : ''} ${isCompleted ? 'completed' : ''}`;
                
                if (isUnlocked && hasQuestions) {
                    card.onclick = () => startLevel(i);
                }

                card.innerHTML = `
                    <div class="level-icon">${level.icon}</div>
                    <div class="level-name" style="color: ${level.color};">${level.name}</div>
                    <div class="level-info">
                        ${levelQuestionsForThisLevel.length} Ø³Ø¤Ø§Ù„ - ${level.passingScore} Ù†Ù‚Ø·Ø© Ù„Ù„Ù†Ø¬Ø§Ø­
                        ${bestScore > 0 ? `<br>ğŸ† Ø£ÙØ¶Ù„ Ù†Ù‚Ø§Ø·Ùƒ: ${bestScore}` : ''}
                        ${currentStudent.totalScores ? `<br>ğŸ’° Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ: ${currentStudent.totalScores}` : ''}
                        ${!hasQuestions ? '<br><span style="color: #e53e3e;">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø©</span>' : ''}
                        ${!isUnlocked ? '<br>ğŸ”’ Ù…Ù‚ÙÙ„' : ''}
                        ${isCompleted ? '<br>âœ… Ù…ÙƒØªÙ…Ù„' : ''}
                    </div>
                `;

                levelCards.appendChild(card);
            }
        }

        function startLevel(levelNum) {
            currentLevel = levelNum;
            const level = levels[levelNum];
            
            const allLevelQuestions = questions.filter(q => q.level == levelNum);
            
            if (allLevelQuestions.length === 0) {
                alert(`Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${levelNum}!`);
                return;
            }
            
            const questionsRequired = level.questionsRequired || 5;
            const questionsToShow = Math.min(questionsRequired, allLevelQuestions.length);
            
            levelQuestions = allLevelQuestions
                .sort(() => Math.random() - 0.5)
                .slice(0, questionsToShow);
            
            document.getElementById('levelSelection').classList.add('hidden');
            document.getElementById('quizContainer').classList.remove('hidden');
            
            const levelHeader = document.getElementById('levelHeader');
            levelHeader.style.background = `linear-gradient(135deg, ${level.color}, ${level.color}dd)`;
            levelHeader.innerHTML = `
                <div style="font-size: 2rem;">${level.icon}</div>
                <div style="font-size: 1.5rem; margin: 10px 0;">${level.name}</div>
                <div>Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${levelNum} - ${levelQuestions.length} Ø³Ø¤Ø§Ù„ - ØªØ­ØªØ§Ø¬ ${level.passingScore} Ù†Ù‚Ø·Ø© Ù„Ù„Ù†Ø¬Ø§Ø­</div>
                <div style="font-size: 0.9rem; margin-top: 5px; opacity: 0.8;">
                    â±ï¸ ${level.time} Ø«Ø§Ù†ÙŠØ© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„
                </div>
            `;
            
            currentQuestionIndex = 0;
            score = 0;
            showQuestion();
        }

        function showQuestion() {
            stopTimer();
            const question = levelQuestions[currentQuestionIndex];
            const questionCard = document.getElementById('questionCard');
            
            document.getElementById('questionNumber').textContent = currentQuestionIndex + 1;
            document.getElementById('totalQuestions').textContent = levelQuestions.length;
            document.getElementById('score').textContent = score;
            
            const progress = ((currentQuestionIndex + 1) / levelQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            let html = `<div class="question-text">${question.question}</div>`;
            
            if (question.type === 'multiple') {
                html += '<div class="options">';
                question.options.forEach((option, index) => {
                    html += `<div class="option" onclick="selectAnswer(${index})">${option}</div>`;
                });
                html += '</div>';
            } else {
                html += '<div class="options">';
                html += '<div class="option" onclick="selectBooleanAnswer(true)">âœ… ØµØ­ÙŠØ­</div>';
                html += '<div class="option" onclick="selectBooleanAnswer(false)">âŒ Ø®Ø·Ø£</div>';
                html += '</div>';
            }
            
            questionCard.innerHTML = html;
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('nextBtn').classList.add('hidden');
            
            startTimer();
        }

        function startTimer() {
            const level = levels[currentLevel];
            timeLeft = level.time;
            updateTimerDisplay();
            
            questionTimer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(questionTimer);
                    timeUp();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerElement = document.getElementById('questionTimer');
            timerElement.textContent = timeLeft;
            
            timerElement.className = 'timer';
            if (timeLeft <= 10) {
                timerElement.classList.add('danger');
            } else if (timeLeft <= 15) {
                timerElement.classList.add('warning');
            }
        }

        function stopTimer() {
            if (questionTimer) {
                clearInterval(questionTimer);
                questionTimer = null;
            }
        }

        function timeUp() {
            const options = document.querySelectorAll('.option');
            options.forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            const question = levelQuestions[currentQuestionIndex];
            if (question.type === 'multiple') {
                const correctOption = document.querySelectorAll('.option')[question.correct];
                correctOption.classList.add('correct');
            } else {
                const correctOption = question.correct ? document.querySelectorAll('.option')[0] : document.querySelectorAll('.option')[1];
                correctOption.classList.add('correct');
            }
            
            showNotification('â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø­Ø§ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø³Ø±Ø¹Ø© Ø£ÙƒØ¨Ø± ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©', 'error');
            document.getElementById('nextBtn').classList.remove('hidden');
        }

        function selectAnswer(selectedIndex) {
            stopTimer();
            const question = levelQuestions[currentQuestionIndex];
            const options = document.querySelectorAll('.option');
            
            options.forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            if (selectedIndex === question.correct) {
                options[selectedIndex].classList.add('correct');
                score += 10;
                showNotification('ğŸ‰ Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!', 'success');
            } else {
                options[selectedIndex].classList.add('incorrect');
                options[question.correct].classList.add('correct');
                showNotification('ğŸ˜” Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!', 'error');
            }
            
            document.getElementById('score').textContent = score;
            document.getElementById('nextBtn').classList.remove('hidden');
        }

        function selectBooleanAnswer(answer) {
            stopTimer();
            const question = levelQuestions[currentQuestionIndex];
            const options = document.querySelectorAll('.option');
            
            options.forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            const selectedOption = answer ? options[0] : options[1];
            const correctOption = question.correct ? options[0] : options[1];
            
            if (answer === question.correct) {
                selectedOption.classList.add('correct');
                score += 10;
                showNotification('ğŸ‰ Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!', 'success');
            } else {
                selectedOption.classList.add('incorrect');
                correctOption.classList.add('correct');
                showNotification('ğŸ˜” Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!', 'error');
            }
            
            document.getElementById('score').textContent = score;
            document.getElementById('nextBtn').classList.remove('hidden');
        }

        function nextQuestion() {
            stopTimer();
            currentQuestionIndex++;
            
            if (currentQuestionIndex < levelQuestions.length) {
                showQuestion();
            } else {
                finishLevel();
            }
        }

        function finishLevel() {
            const level = levels[currentLevel];
            
            const existingIndex = studentsData.findIndex(s => s.name === currentStudent.name && s.class === currentStudent.class);
            
            if (existingIndex !== -1) {
                if (!studentsData[existingIndex].totalScores) {
                    studentsData[existingIndex].totalScores = 0;
                }
                if (!studentsData[existingIndex].attempts) {
                    studentsData[existingIndex].attempts = {};
                }
                
                studentsData[existingIndex].totalScores += score;
                
                if (!studentsData[existingIndex].attempts[currentLevel]) {
                    studentsData[existingIndex].attempts[currentLevel] = [];
                }
                studentsData[existingIndex].attempts[currentLevel].push({
                    score: score,
                    date: new Date().toISOString()
                });
                
                if (!studentsData[existingIndex].scores) {
                    studentsData[existingIndex].scores = {};
                }
                const currentBestScore = studentsData[existingIndex].scores[currentLevel] || 0;
                if (score > currentBestScore) {
                    studentsData[existingIndex].scores[currentLevel] = score;
                }
                
                if (score >= level.passingScore && !studentsData[existingIndex].completedLevels.includes(currentLevel)) {
                    studentsData[existingIndex].completedLevels.push(currentLevel);
                }
                
                if (score >= level.passingScore) {
                    studentsData[existingIndex].maxLevel = Math.max(studentsData[existingIndex].maxLevel || 1, currentLevel + 1);
                }
                
            } else {
                const newStudent = {
                    name: currentStudent.name,
                    class: currentStudent.class,
                    maxLevel: score >= level.passingScore ? currentLevel + 1 : 1,
                    completedLevels: score >= level.passingScore ? [currentLevel] : [],
                    scores: {
                        [currentLevel]: score
                    },
                    totalScores: score,
                    attempts: {
                        [currentLevel]: [{
                            score: score,
                            date: new Date().toISOString()
                        }]
                    }
                };
                studentsData.push(newStudent);
            }
            
            syncData();
            showLevelCompleteModal(score >= level.passingScore);
        }

        function showLevelCompleteModal(passed) {
            const level = levels[currentLevel];
            const modal = document.getElementById('levelCompleteModal');
            const modalContent = document.getElementById('modalContent');
            
            const totalPossibleScore = levelQuestions.length * 10;
            const existingStudent = studentsData.find(s => s.name === currentStudent.name && s.class === currentStudent.class);
            const totalScores = existingStudent ? existingStudent.totalScores : score;
            
            modalContent.innerHTML = `
                <div style="font-size: 4rem; margin-bottom: 20px;">${level.icon}</div>
                <h2 style="color: ${passed ? level.color : '#e53e3e'}; margin-bottom: 20px;">
                    ${passed ? 'ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ğŸ‰' : 'ğŸ˜” Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!'}
                </h2>
                <p style="font-size: 1.3rem; margin-bottom: 20px;">
                    ${passed ? 
                        `Ù„Ù‚Ø¯ Ø£Ø¬Ø¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!` : 
                        `ØªØ­ØªØ§Ø¬ ${level.passingScore} Ù†Ù‚Ø·Ø© Ù„Ù„Ù†Ø¬Ø§Ø­ ÙÙŠ Ù…Ø±Ø­Ù„Ø© ${level.name}`
                    }
                </p>
                <p style="font-size: 1.5rem; color: ${passed ? '#38a169' : '#e53e3e'}; margin-bottom: 10px;">
                    ğŸ† Ù†Ù‚Ø§Ø· Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${score} Ù…Ù† ${totalPossibleScore}
                </p>
                <p style="font-size: 1.3rem; color: #667eea; margin-bottom: 30px;">
                    ğŸ’° Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ: ${totalScores} Ù†Ù‚Ø·Ø©
                </p>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn" onclick="retryLevel()" style="background: ${level.color};">
                        ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    </button>
                </div>
                
                ${passed && currentLevel < 5 ? `
                    <div style="margin-bottom: 20px;">
                        <button class="btn" onclick="continueToNextLevel()" style="background: ${levels[currentLevel + 1].color};">
                            ${levels[currentLevel + 1].icon} Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
                        </button>
                    </div>
                ` : ''}
                
                <button class="btn" onclick="backToLevelSelection()">
                    â†©ï¸ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±Ø­Ù„Ø© Ø£Ø®Ø±Ù‰
                </button>
            `;
            
            modal.classList.remove('hidden');
        }

        function continueToNextLevel() {
            document.getElementById('levelCompleteModal').classList.add('hidden');
            currentStudent.maxLevel = currentLevel + 1;
            startLevel(currentLevel + 1);
        }

        function retryLevel() {
            document.getElementById('levelCompleteModal').classList.add('hidden');
            startLevel(currentLevel);
        }

        function backToLevelSelection() {
            document.getElementById('levelCompleteModal').classList.add('hidden');
            document.getElementById('quizContainer').classList.add('hidden');
            document.getElementById('levelSelection').classList.remove('hidden');
            
            const existingStudent = studentsData.find(s => s.name === currentStudent.name && s.class === currentStudent.class);
            if (existingStudent) {
                currentStudent.maxLevel = existingStudent.maxLevel;
                currentStudent.completedLevels = existingStudent.completedLevels;
                currentStudent.totalScores = existingStudent.totalScores;
                currentStudent.scores = existingStudent.scores;
            }
            
            displayLevelCards();
        }

        // ğŸ‘¨â€ğŸ« Ø¯ÙˆØ§Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…
        function showTeacherLogin() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('teacherLoginForm').classList.remove('hidden');
        }

        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('teacherLoginForm').classList.add('hidden');
            document.getElementById('levelSelection').classList.add('hidden');
            document.getElementById('quizContainer').classList.add('hidden');
            document.getElementById('teacherPanel').classList.add('hidden');
            document.getElementById('editQuestionModal').classList.add('hidden');
            document.getElementById('levelCompleteModal').classList.add('hidden');
            stopTimer();
        }

        function verifyTeacherLogin() {
            const email = document.getElementById('teacherEmail').value.trim();
            const password = document.getElementById('teacherPassword').value.trim();
            
            const correctEmail = 'chartgain2019@gmail.com';
            const correctPassword = 'sa123456';
            
            if (email === correctEmail && password === correctPassword) {
                document.getElementById('teacherLoginForm').classList.add('hidden');
                document.getElementById('teacherPanel').classList.remove('hidden');
                showTab('stats');
            } else {
                document.getElementById('loginError').classList.remove('hidden');
            }
        }

        function showTab(tab) {
            currentTab = tab;
            
            document.getElementById('statsSection').classList.add('hidden');
            document.getElementById('questionsSection').classList.add('hidden');
            document.getElementById('timerSection').classList.add('hidden');
            
            document.getElementById('statsTab').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            document.getElementById('questionsTab').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            document.getElementById('timerTab').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            
            if (tab === 'stats') {
                document.getElementById('statsSection').classList.remove('hidden');
                document.getElementById('statsTab').style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
                updateTeacherPanel();
            } else if (tab === 'questions') {
                document.getElementById('questionsSection').classList.remove('hidden');
                document.getElementById('questionsTab').style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
                displayQuestionsList();
            } else if (tab === 'timer') {
                document.getElementById('timerSection').classList.remove('hidden');
                document.getElementById('timerTab').style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
                displayLevelSettings();
            }
        }

        function updateTeacherPanel() {
            const levelCounts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0};
            
            studentsData.forEach(student => {
                if (student.completedLevels && student.completedLevels.length > 0) {
                    const highestLevel = Math.max(...student.completedLevels);
                    levelCounts[highestLevel]++;
                }
            });

            document.getElementById('level1Count').textContent = levelCounts[1];
            document.getElementById('level2Count').textContent = levelCounts[2];
            document.getElementById('level3Count').textContent = levelCounts[3];
            document.getElementById('level4Count').textContent = levelCounts[4];
            document.getElementById('level5Count').textContent = levelCounts[5];
            
            const topStudents = studentsData
                .filter(student => student.totalScores > 0)
                .sort((a, b) => b.totalScores - a.totalScores);
            
            const leaderboardList = document.getElementById('leaderboardList');
            
            if (topStudents.length === 0) {
                leaderboardList.innerHTML = '<div style="text-align: center; color: #718096;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø·Ù„Ø§Ø¨ Ø¨Ø¹Ø¯</div>';
            } else {
                leaderboardList.innerHTML = topStudents.map((student, index) => {
                    const highestLevel = student.completedLevels && student.completedLevels.length > 0 ? 
                        Math.max(...student.completedLevels) : 0;
                    const level = levels[highestLevel] || levels[1];
                    const totalAttempts = student.attempts ? 
                        Object.values(student.attempts).flat().length : 0;
                    
                    return `
                        <div class="student-row">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div class="rank">${index + 1}</div>
                                <div>
                                    <div style="font-weight: bold;">${student.name}</div>
                                    <div style="color: #718096; font-size: 0.9rem;">Ø§Ù„ÙØµÙ„: ${student.class}</div>
                                </div>
                            </div>
                            <div style="text-align: left;">
                                <div style="font-weight: bold; color: ${level.color}; margin-bottom: 5px;">
                                    ${level.name}
                                </div>
                                <div style="font-size: 0.9rem; color: #718096;">
                                    Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª: ${totalAttempts}
                                </div>
                            </div>
                            <div style="text-align: center; min-width: 100px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">
                                    ${student.totalScores || 0}
                                </div>
                                <div style="font-size: 0.8rem; color: #718096;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ù†Ù‚Ø§Ø·
        function calculateTotalScore(student) {
            if (!student.scores) return 0;
            return Object.values(student.scores).reduce((total, score) => total + score, 0);
        }
        
        function exportLeaderboardExcel() {
            try {
                const topStudents = studentsData
                    .filter(student => student.totalScores > 0)
                    .sort((a, b) => b.totalScores - a.totalScores);
        
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ CSV
                let csvContent = 'Ø§Ù„ØªØ±ØªÙŠØ¨,Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨,Ø§Ù„ÙØµÙ„,Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠØ©,Ø£Ø¹Ù„Ù‰ Ù…Ø±Ø­Ù„Ø©,Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª,ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØµØ¯ÙŠØ±\n';
        
                topStudents.forEach((student, index) => {
                    const row = [
                        index + 1,
                        `"${student.name}"`,
                        student.class,
                        student.totalScores || 0,
                        getStudentHighestLevel(student),
                        getStudentAttemptsCount(student)
                    ].join(',');
            
                    csvContent += row + '\n';
                });
        
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù ÙˆØªÙ†Ø²ÙŠÙ„Ù‡
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
        
                link.setAttribute('href', url);
                link.setAttribute('download', `Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ø´Ø±Ù_Ù…Ø³Ø§Ø¨Ù‚Ø©_Ø§Ù„Ø¹Ù„ÙˆÙ…_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
        
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
        
                showNotification('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø±Ù ÙƒÙ…Ù„Ù Excel', 'success');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Excel:', error);
                showNotification('âŒ ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Excel', 'error');
            }
        }

        function printLeaderboard() { 
            try {
                const topStudents = studentsData
                    .filter(student => student.totalScores > 0)
                    .sort((a, b) => b.totalScores - a.totalScores);
        
                // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
                const printWindow = window.open('', '_blank');
                const printDate = new Date().toLocaleDateString('ar-SA');
        
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html dir="rtl">
                    <head>
                        <title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø±Ù - Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¹Ù„ÙˆÙ…</title>
                        <style>
                            body { 
                                font-family: Arial, sans-serif; 
                                margin: 20px; 
                                direction: rtl;
                            }
                            .header { 
                                text-align: center; 
                                margin-bottom: 30px;
                                border-bottom: 3px solid #667eea;
                                padding-bottom: 15px;
                            }
                            .header h1 { 
                                color: #2d3748; 
                                margin: 0;
                                font-size: 24px;
                            }
                            .header .date { 
                                color: #718096; 
                                margin-top: 10px;
                            }
                            table { 
                                width: 100%; 
                                border-collapse: collapse; 
                                margin-top: 20px;
                            }
                            th { 
                                background: #667eea; 
                                color: white; 
                                padding: 12px; 
                                text-align: center;
                                border: 1px solid #ddd;
                            }
                            td { 
                                padding: 10px; 
                                text-align: center; 
                                border: 1px solid #ddd;
                            }
                            tr:nth-child(even) { 
                                background: #f7fafc; 
                            }
                            .footer { 
                                text-align: center; 
                                margin-top: 30px; 
                                color: #718096; 
                                font-size: 12px;
                                border-top: 1px solid #e2e8f0;
                                padding-top: 15px;
                            }
                            @media print {
                                body { margin: 0; }
                                .no-print { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>ğŸ† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø±Ù - Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¹Ù„ÙˆÙ… ğŸ†</h1>
                            <div class="date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${printDate}</div>
                        </div>
                
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                    <th>Ø§Ù„ÙØµÙ„</th>
                                    <th>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠØ©</th>
                                    <th>Ø£Ø¹Ù„Ù‰ Ù…Ø±Ø­Ù„Ø©</th>
                                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${topStudents.map((student, index) => `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${student.name}</td>
                                        <td>${student.class}</td>
                                        <td><strong>${student.totalScores || 0}</strong></td>
                                        <td>${getStudentHighestLevel(student)}</td>
                                        <td>${getStudentAttemptsCount(student)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                
                        <div class="footer">
                            <p>Ù…Ø¯Ø±Ø³Ø© Ø§Ù„ÙˆÙ„ÙŠØ¯ Ø¨Ù† Ø¹Ù…Ø§Ø±Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© - ØªØµÙ…ÙŠÙ…: Ø§Ù„Ø£Ø³ØªØ§Ø° / Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù‡Ø±ÙŠ</p>
                            <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨: ${topStudents.length} Ø·Ø§Ù„Ø¨</p>
                        </div>
                
                        <div class="no-print" style="text-align: center; margin-top: 20px;">
                            <button onclick="window.print()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
                            </button>
                            <button onclick="window.close()" style="padding: 10px 20px; background: #e53e3e; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                                Ø¥ØºÙ„Ø§Ù‚
                            </button>
                        </div>
                    </body>
                    </html>
                `);
        
                printWindow.document.close();
        
                showNotification('âœ… ØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©', 'success');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©:', error);
                showNotification('âŒ ÙØ´Ù„ ÙÙŠ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©', 'error');
            }
        }

        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        function getStudentHighestLevel(student) {
            if (!student.completedLevels || student.completedLevels.length === 0) {
                return 'Ù„Ù… ÙŠØ¨Ø¯Ø£';
            }
            const highestLevel = Math.max(...student.completedLevels);
            const level = levels[highestLevel];
            return level ? level.name : `Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${highestLevel}`;
        }

        function getStudentAttemptsCount(student) {
            if (!student.attempts) return 0;
            return Object.values(student.attempts).flat().length;
        }

        // âš™ï¸ Ø¯ÙˆØ§Ù„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø­Ù„
        function displayLevelSettings() {
            const levelSettings = document.getElementById('levelSettings');
            
            let html = '';
            for (let levelNum = 1; levelNum <= 5; levelNum++) {
                const level = levels[levelNum];
                const questionsCount = questions.filter(q => q.level == levelNum).length;
                
                html += `
                    <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-right: 4px solid ${level.color};">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                            <span style="font-size: 2rem;">${level.icon}</span>
                            <div>
                                <div style="font-weight: bold; color: ${level.color}; font-size: 1.2rem;">${level.name}</div>
                                <div style="color: #718096;">Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${levelNum}</div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                            <div class="form-group">
                                <label>â±ï¸ ÙˆÙ‚Øª Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø«Ø§Ù†ÙŠØ©):</label>
                                <input type="number" id="levelTime${levelNum}" min="5" max="120" value="${level.time}" style="text-align: center;">
                            </div>
                            
                            <div class="form-group">
                                <label>ğŸ¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ù†Ø¬Ø§Ø­:</label>
                                <input type="number" id="levelPassingScore${levelNum}" min="10" max="200" value="${level.passingScore}" style="text-align: center;">
                            </div>
                            
                            <div class="form-group">
                                <label>ğŸ“ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</label>
                                <input type="number" id="levelQuestionsRequired${levelNum}" min="1" max="20" value="${level.questionsRequired || 5}" style="text-align: center;">
                            </div>
                        </div>
                        
                        <div style="background: #f0fff4; padding: 12px; border-radius: 8px; text-align: center;">
                            <div style="color: #22543d; font-weight: bold;">
                                ğŸ“Š Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ØªØ§Ø­Ø©: ${questionsCount} Ø³Ø¤Ø§Ù„
                            </div>
                            ${questionsCount < (level.questionsRequired || 5) ? 
                                `<div style="color: #e53e3e; font-size: 0.9rem; margin-top: 5px;">
                                    âš ï¸ ØªØ­ØªØ§Ø¬ ${(level.questionsRequired || 5) - questionsCount} Ø£Ø³Ø¦Ù„Ø© Ø¥Ø¶Ø§ÙÙŠØ©
                                </div>` : 
                                `<div style="color: #38a169; font-size: 0.9rem; margin-top: 5px;">
                                    âœ… Ø§Ù„Ø¹Ø¯Ø¯ ÙƒØ§ÙÙŠ
                                </div>`
                            }
                        </div>
                    </div>
                `;
            }
            
            levelSettings.innerHTML = html;
        }

        async function saveLevelSettings() {
            for (let levelNum = 1; levelNum <= 5; levelNum++) {
                const timeInput = document.getElementById(`levelTime${levelNum}`);
                const passingScoreInput = document.getElementById(`levelPassingScore${levelNum}`);
                const questionsRequiredInput = document.getElementById(`levelQuestionsRequired${levelNum}`);
                
                levels[levelNum].time = parseInt(timeInput.value);
                levels[levelNum].passingScore = parseInt(passingScoreInput.value);
                levels[levelNum].questionsRequired = parseInt(questionsRequiredInput.value);
            }
            
            await syncData();
            showNotification('âœ… ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }

        // ğŸ” Ø¯Ø§Ù„Ø© Ù„ÙØ­Øµ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©
        function checkLevelsQuestions() {
            console.log('ğŸ” ÙØ­Øµ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©:');
            
            let message = 'ğŸ” ÙØ­Øµ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©:\n\n';
            
            for (let levelNum = 1; levelNum <= 5; levelNum++) {
                const levelQuestionsCount = questions.filter(q => q.level == levelNum).length;
                const level = levels[levelNum];
                const required = level.questionsRequired || 5;
                
                message += `${level.icon} Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${levelNum}: ${levelQuestionsCount}/${required} Ø³Ø¤Ø§Ù„\n`;
                
                if (levelQuestionsCount < required) {
                    message += `   âš ï¸ ÙŠØ­ØªØ§Ø¬ ${required - levelQuestionsCount} Ø£Ø³Ø¦Ù„Ø© Ø¥Ø¶Ø§ÙÙŠØ©\n`;
                } else {
                    message += `   âœ… Ø§Ù„Ø¹Ø¯Ø¯ ÙƒØ§ÙÙŠ\n`;
                }
                message += '\n';
            }
            
            alert(message);
        }

        // â“ Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        function toggleQuestionType() {
            const questionType = document.getElementById('questionType').value;
            const multipleOptions = document.getElementById('multipleChoiceOptions');
            const booleanOptions = document.getElementById('booleanOptions');
            
            if (questionType === 'multiple') {
                multipleOptions.classList.remove('hidden');
                booleanOptions.classList.add('hidden');
            } else {
                multipleOptions.classList.add('hidden');
                booleanOptions.classList.remove('hidden');
            }
        }

        async function addQuestion() {
            const questionLevel = document.getElementById('questionLevel').value;
            const questionType = document.getElementById('questionType').value;
            const questionText = document.getElementById('questionText').value.trim();
            
            if (!questionText) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„', 'error');
                return;
            }

            let newQuestion = {
                type: questionType,
                question: questionText,
                level: parseInt(questionLevel),
                id: Date.now()
            };

            if (questionType === 'multiple') {
                const option1 = document.getElementById('option1').value.trim();
                const option2 = document.getElementById('option2').value.trim();
                const option3 = document.getElementById('option3').value.trim();
                const correctOption = parseInt(document.getElementById('correctOption').value);

                if (!option1 || !option2 || !option3) {
                    showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø«Ù„Ø§Ø«Ø©', 'error');
                    return;
                }

                newQuestion.options = [option1, option2, option3];
                newQuestion.correct = correctOption;
            } else {
                const booleanAnswer = document.getElementById('booleanAnswer').value === 'true';
                newQuestion.correct = booleanAnswer;
            }

            questions.push(newQuestion);
            await syncData();
            clearQuestionForm();
            displayQuestionsList();
            
            showNotification('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }

        function displayQuestionsList() {
            const questionsList = document.getElementById('questionsList');
            
            if (questions.length === 0) {
                questionsList.innerHTML = '<div style="text-align: center; color: #718096; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯</div>';
                return;
            }

            const questionsByLevel = {};
            questions.forEach(question => {
                if (!questionsByLevel[question.level]) {
                    questionsByLevel[question.level] = [];
                }
                questionsByLevel[question.level].push(question);
            });

            let html = '';
            for (let levelNum = 1; levelNum <= 5; levelNum++) {
                const levelQuestions = questionsByLevel[levelNum] || [];
                const level = levels[levelNum];
                
                html += `
                    <div style="margin-bottom: 30px;">
                        <h4 style="color: ${level.color}; margin-bottom: 15px;">
                            ${level.icon} ${level.name} (${levelQuestions.length} Ø£Ø³Ø¦Ù„Ø©)
                        </h4>
                `;

                if (levelQuestions.length === 0) {
                    html += '<div style="text-align: center; color: #718096; padding: 10px; background: #f7fafc; border-radius: 8px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</div>';
                } else {
                    levelQuestions.forEach((question, index) => {
                        let optionsText = '';
                        if (question.type === 'multiple') {
                            optionsText = question.options.map((option, i) => 
                                `<span style="color: ${i === question.correct ? '#38a169' : '#718096'};">
                                    ${i === question.correct ? 'âœ…' : 'â€¢'} ${option}
                                </span>`
                            ).join('<br>');
                        } else {
                            optionsText = `<span style="color: #38a169;">âœ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: ${question.correct ? 'ØµØ­ÙŠØ­' : 'Ø®Ø·Ø£'}</span>`;
                        }

                        html += `
                            <div class="student-row" style="flex-direction: column; align-items: stretch; margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; gap: 15px;">
                                    <div style="display: flex; align-items: flex-start; gap: 15px; flex: 1;">
                                        <div class="rank" style="background: ${level.color};">${index + 1}</div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: bold; margin-bottom: 5px; font-size: 1.1rem;">${question.question}</div>
                                            <div style="font-size: 0.9rem; color: #667eea; margin-bottom: 10px;">
                                                ${question.type === 'multiple' ? 'Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯' : 'ØµØ­ ÙˆØ®Ø·Ø£'} | Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${levelNum}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="question-actions" style="display: flex; gap: 8px; flex-shrink: 0;">
                                        <button class="btn-edit" onclick="editQuestion('${question.id}')">
                                            âœï¸ ØªØ¹Ø¯ÙŠÙ„
                                        </button>
                                        <button class="btn-delete" onclick="deleteQuestion('${question.id}')">
                                            ğŸ—‘ï¸ Ø­Ø°Ù
                                        </button>
                                    </div>
                                </div>
                                <div style="font-size: 0.9rem; padding: 12px; background: #f7fafc; border-radius: 6px;">
                                    <div style="font-weight: bold; margin-bottom: 8px; color: #4a5568;">Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª:</div>
                                    ${optionsText}
                                </div>
                            </div>
                        `;
                    });
                }

                html += '</div>';
            }

            questionsList.innerHTML = html;
        }

        async function deleteQuestion(questionId) {
            if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ')) {
                questions = questions.filter(q => q.id != questionId);
                await syncData();
                displayQuestionsList();
                showNotification('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            }
        }

        function editQuestion(questionId) {
            currentEditingQuestion = questions.find(q => q.id == questionId);
            if (!currentEditingQuestion) return;

            const modal = document.getElementById('editQuestionModal');
            const modalContent = document.querySelector('.edit-modal-content');
            
            modalContent.innerHTML = `
                <h3 style="color: #4a5568; margin-bottom: 20px;">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„</h3>
                
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø±Ø­Ù„Ø©:</label>
                    <select id="editQuestionLevel">
                        ${Object.entries(levels).map(([key, level]) => 
                            `<option value="${key}" ${currentEditingQuestion.level == key ? 'selected' : ''}>${level.icon} ${level.name}</option>`
                        ).join('')}
                </select>
                </div>

                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
                    <select id="editQuestionType" onchange="toggleEditQuestionType()">
                        <option value="multiple" ${currentEditingQuestion.type === 'multiple' ? 'selected' : ''}>Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</option>
                        <option value="boolean" ${currentEditingQuestion.type === 'boolean' ? 'selected' : ''}>ØµØ­ ÙˆØ®Ø·Ø£</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
                    <textarea id="editQuestionText" rows="3">${currentEditingQuestion.question}</textarea>
                </div>

                <div id="editMultipleChoiceOptions" ${currentEditingQuestion.type === 'boolean' ? 'class="hidden"' : ''}>
                    ${currentEditingQuestion.type === 'multiple' ? currentEditingQuestion.options.map((option, index) => `
                        <div class="form-group">
                            <label>Ø§Ù„Ø®ÙŠØ§Ø± ${index + 1}:</label>
                            <input type="text" id="editOption${index + 1}" value="${option}">
                        </div>
                    `).join('') : ''}
                    <div class="form-group">
                        <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</label>
                        <select id="editCorrectOption">
                            ${currentEditingQuestion.type === 'multiple' ? currentEditingQuestion.options.map((option, index) => 
                                `<option value="${index}" ${currentEditingQuestion.correct == index ? 'selected' : ''}>Ø§Ù„Ø®ÙŠØ§Ø± ${index + 1}</option>`
                            ).join('') : ''}
                        </select>
                    </div>
                </div>

                <div id="editBooleanOptions" ${currentEditingQuestion.type === 'multiple' ? 'class="hidden"' : ''}>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</label>
                        <select id="editBooleanAnswer">
                            <option value="true" ${currentEditingQuestion.correct === true ? 'selected' : ''}>ØµØ­ÙŠØ­</option>
                            <option value="false" ${currentEditingQuestion.correct === false ? 'selected' : ''}>Ø®Ø·Ø£</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" onclick="saveEditedQuestion()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                    <button class="btn" onclick="closeEditModal()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function toggleEditQuestionType() {
            const questionType = document.getElementById('editQuestionType').value;
            const multipleOptions = document.getElementById('editMultipleChoiceOptions');
            const booleanOptions = document.getElementById('editBooleanOptions');
            
            if (questionType === 'multiple') {
                multipleOptions.classList.remove('hidden');
                booleanOptions.classList.add('hidden');
            } else {
                multipleOptions.classList.add('hidden');
                booleanOptions.classList.remove('hidden');
            }
        }

        async function saveEditedQuestion() {
            const questionLevel = document.getElementById('editQuestionLevel').value;
            const questionType = document.getElementById('editQuestionType').value;
            const questionText = document.getElementById('editQuestionText').value.trim();
            
            if (!questionText) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„', 'error');
                return;
            }

            currentEditingQuestion.level = parseInt(questionLevel);
            currentEditingQuestion.type = questionType;
            currentEditingQuestion.question = questionText;

            if (questionType === 'multiple') {
                const option1 = document.getElementById('editOption1').value.trim();
                const option2 = document.getElementById('editOption2').value.trim();
                const option3 = document.getElementById('editOption3').value.trim();
                const correctOption = parseInt(document.getElementById('editCorrectOption').value);

                if (!option1 || !option2 || !option3) {
                    showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø«Ù„Ø§Ø«Ø©', 'error');
                    return;
                }

                currentEditingQuestion.options = [option1, option2, option3];
                currentEditingQuestion.correct = correctOption;
            } else {
                const booleanAnswer = document.getElementById('editBooleanAnswer').value === 'true';
                currentEditingQuestion.correct = booleanAnswer;
            }

            await syncData();
            displayQuestionsList();
            closeEditModal();
            
            showNotification('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }

        function closeEditModal() {
            document.getElementById('editQuestionModal').classList.add('hidden');
            currentEditingQuestion = null;
        }

        function clearQuestionForm() {
            document.getElementById('questionText').value = '';
            document.getElementById('option1').value = '';
            document.getElementById('option2').value = '';
            document.getElementById('option3').value = '';
            document.getElementById('correctOption').value = '0';
            document.getElementById('booleanAnswer').value = 'true';
            document.getElementById('questionType').value = 'multiple';
            toggleQuestionType();
        }

        // ğŸ—‘ï¸ Ø¯ÙˆØ§Ù„ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function clearAllData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ\n\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨!')) {
                questions = [...defaultQuestions];
                studentsData = [];
                levels = JSON.parse(JSON.stringify(defaultLevels));
                await syncData();
                updateTeacherPanel();
                displayQuestionsList();
                showNotification('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            }
        }

        // ğŸ”” Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        function showNotification(message, type = 'info') {
            const colors = {
                success: '#48bb78',
                error: '#e53e3e',
                info: '#4299e1',
                warning: '#ed8936'
            };
            
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${colors[type] || colors.info};
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                z-index: 10000;
                font-weight: bold;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ğŸ“¥ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', async function() {
            await loadData();
            setupRealtimeUpdates();
            console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ JSONBin');
        });
    </script>
</body>
</html>